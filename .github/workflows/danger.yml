name: CI

on:
    pull_request:
        types: [opened, reopened, edited, synchronize]
        paths:
            - ".github/workflows/swiftlint.yml"
            - ".swiftlint.yml"
            - "**/*.swift"
jobs:
    build:
        runs-on: macos-latest
        steps:
            - name: Checkout code
              uses: actions/checkout@v2
              with:
                  fetch-depth: 0

            - name: Set up Ruby
              uses: ruby/setup-ruby@v1
              with:
                  ruby-version: 3.0.5

            # - name: Install danger-js
            #   run: brew install danger/tap/danger-js

            # - name: Install Danger
            #   run: |
            #       brew install danger/tap/danger-js
            #   env:
            #       GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

            - name: Danger
              uses: 417-72KI/danger-swiftlint@v5.9 # Look at the `Note for version`
              env:
                  DANGER_GITHUB_API_TOKEN: ${{ secrets.DANGER_GITHUB_API_TOKEN }}

            - name: Cache RubyGems
              uses: actions/cache@v2
              with:
                  path: vendor/bundle
                  key: ${{ runner.os }}-gems-${{ hashFiles('**/Gemfile.lock') }}
                  restore-keys: |
                      ${{ runner.os }}-gems-

            # - name: Bundle install
            #   run: |
            #       gem install bundler
            #       bundle config path vendor/bundle
            #       bundle install --jobs 4 --retry 3

            - name: Run Danger
              run: danger-swift ci
              env:
                  DANGER_GITHUB_API_TOKEN: ${{ secrets.DANGER_GITHUB_API_TOKEN }}
